[tox]
envlist = py310,py311,py312,lint,type,docs
skip_missing_interpreters = true

[testenv]
description = Run unit tests with pytest
deps =
    pytest>=7.0
    pytest-cov>=4.0
    pytest-xdist>=3.0
extras = dev
commands =
    pytest {posargs:tests}

[testenv:py310]
basepython = python3.10

[testenv:py311]
basepython = python3.11

[testenv:py312]
basepython = python3.12

[testenv:lint]
description = Run linting checks (flake8, pylint)
basepython = python3.12
deps =
    flake8>=6.0
    pylint>=2.15
skip_install = false
commands =
    flake8 sim_env tests
    pylint sim_env --disable=all --enable=E,F

[testenv:format]
description = Format code with black and isort
basepython = python3.12
deps =
    black>=23.0
    isort>=5.11
skip_install = true
commands =
    black sim_env tests
    isort sim_env tests

[testenv:format-check]
description = Check code formatting without making changes
basepython = python3.12
deps =
    black>=23.0
    isort>=5.11
skip_install = true
commands =
    black --check sim_env tests
    isort --check-only sim_env tests

[testenv:type]
description = Run type checking with mypy
basepython = python3.12
deps =
    mypy>=1.0
extras = dev
commands =
    mypy sim_env

[testenv:coverage]
description = Run tests and generate coverage report
basepython = python3.12
deps =
    pytest>=7.0
    pytest-cov>=4.0
extras = dev
commands =
    pytest --cov=sim_env --cov-report=html --cov-report=term-missing tests

[testenv:docs]
description = Build documentation
basepython = python3.12
changedir = docs
extras = docs
commands =
    mkdocs build

[testenv:docs-serve]
description = Serve documentation locally
basepython = python3.12
changedir = docs
extras = docs
commands =
    mkdocs serve

[testenv:clean]
description = Remove temporary files and caches
basepython = python3.12
skip_install = true
commands =
    bash -c 'find . -type d -name __pycache__ -exec rm -rf {{}} + 2>/dev/null || true'
    bash -c 'find . -type d -name .pytest_cache -exec rm -rf {{}} + 2>/dev/null || true'
    bash -c 'find . -type d -name .mypy_cache -exec rm -rf {{}} + 2>/dev/null || true'
    bash -c 'find . -type d -name htmlcov -exec rm -rf {{}} + 2>/dev/null || true'
